<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Stacja Pogodowa Wierzchowisko</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #0a0f1f;
        color: #e0eaff;
        margin: 0;
        padding: 0;
        text-align: center;
    }

    h1 {
        margin-top: 25px;
        font-size: 42px;
        letter-spacing: 2px;
        text-shadow: 0 0 10px #00eaff, 0 0 20px #00eaff;
    }

    .card {
        background: rgba(20, 30, 50, 0.85);
        padding: 25px;
        margin: 25px auto;
        width: 450px;
        border-radius: 15px;
        box-shadow: 0 0 25px rgba(0, 200, 255, 0.25);
        backdrop-filter: blur(4px);
    }

    .value {
        font-size: 45px;
        margin: 10px 0;
        text-shadow: 0 0 10px #00eaff;
    }

    button {
        padding: 12px 22px;
        margin: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 17px;
        color: white;
        background: #9333ea;
    }

    #logBox {
        width: 450px;
        height: 200px;
        margin: 20px auto;
        background: rgba(10, 15, 30, 0.8);
        border-radius: 10px;
        padding: 10px;
        overflow-y: scroll;
        font-family: monospace;
        font-size: 15px;
        text-align: left;
        box-shadow: 0 0 20px rgba(0, 200, 255, 0.2);
        white-space: pre-line;
    }

    #error {
        color: #ff4444;
        font-size: 18px;
        margin-top: 10px;
        text-shadow: 0 0 10px #ff4444;
    }

    #lastRecord {
        margin-top: 10px;
        font-size: 18px;
        opacity: 0.8;
    }
</style>
</head>
<body>

<h1>Stacja Pogodowa Wierzchowisko</h1>

<div class="card">
    <h2>Temperatura</h2>
    <div id="temp" class="value">-- °C</div>

    <h2>Wilgotność</h2>
    <div id="hum" class="value">-- %</div>

    <div id="lastRecord">Ostatni pomiar: --</div>

    <button id="fetchBtn">Pobierz dane teraz</button>
    <div id="error"></div>
</div>

<h2>Logi Stacji Wierzchowisko</h2>
<div id="logBox">Oczekiwanie na pobranie danych...</div>

<p style="margin-top:40px; opacity:0.6;">made by g4m3r and MC-AI</p>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC7JBHvOysb0VsyijNfqyZOzgT7lr6vGmg",
        databaseURL: "https://esp32-meteo-43e58-default-rtdb.europe-west1.firebasedatabase.app",
        authDomain: "esp32-meteo-43e58.firebaseapp.com"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const tempEl = document.getElementById("temp");
    const humEl = document.getElementById("hum");
    const lastRecordEl = document.getElementById("lastRecord");
    const errorEl = document.getElementById("error");
    const logBox = document.getElementById("logBox");

    function addLog(text) {
        logBox.textContent += text + "\n";
        logBox.scrollTop = logBox.scrollHeight;
    }

    async function fetchData() {
        errorEl.textContent = "";

        try {
            const tempSnap = await db.ref("/stacja/temp").get();
            const humSnap = await db.ref("/stacja/hum").get();
            const lastTempSnap = await db.ref("/ostatni/temp").get();
            const lastHumSnap = await db.ref("/ostatni/hum").get();

            if (!tempSnap.exists() || !humSnap.exists()) {
                throw new Error("Brak danych");
            }

            const temp = tempSnap.val();
            const hum = humSnap.val();

            tempEl.textContent = temp + " °C";
            humEl.textContent = hum + " %";

            const now = new Date().toLocaleTimeString();
            lastRecordEl.textContent = "Ostatni pomiar: " + now;

            addLog(`[${now}] Temp=${temp}°C  Hum=${hum}%`);

        } catch (err) {
            errorEl.textContent = "błąd pobrania: stacja nie odpowiada";
            addLog(`[ERROR] ${err.message}`);
        }
    }

    document.getElementById("fetchBtn").onclick = fetchData;
    document.getElementById("fetchBtn").onclick = fetchData;

// Automatyczne pobieranie co 10 sekund
setInterval(fetchData, 10000);
</script>

</body>
</html>

