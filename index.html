<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Meteo Mission Control</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #0b0f1a;
        color: white;
        text-align: center;
        margin: 0;
        padding: 0;
    }

    h1 {
        margin-top: 20px;
        font-size: 32px;
        letter-spacing: 2px;
    }

    .card {
        background: #111827;
        padding: 20px;
        margin: 20px auto;
        width: 300px;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }

    .status {
        font-size: 20px;
        margin-top: 10px;
    }

    .online { color: #00ff88; }
    .offline { color: #ff4444; }

    button {
        padding: 10px 20px;
        margin: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
    }

    #refreshBtn { background: #2563eb; color: white; }
    #colorBtn { background: #9333ea; color: white; }

    /* --- PRZYCISK MYINSTANTS --- */
    #soundBtn {
        position: fixed;
        top: 10px;
        right: 10px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: #ff2b2b;
        border: 4px solid #b30000;
        cursor: pointer;
        opacity: 0.5;
        transition: 0.2s;
        z-index: 9999;
    }

    #soundBtn:hover {
        opacity: 1;
        transform: scale(1.1);
    }

    #soundFrame {
        display: none;
    }
</style>
</head>
<body>

<h1>METEO MISSION CONTROL</h1>

<div class="card">
    <h2>Temperatura</h2>
    <div id="temp">-- °C</div>

    <h2>Wilgotność</h2>
    <div id="hum">-- %</div>

    <div id="status" class="status offline">● OFFLINE</div>

    <button id="refreshBtn">Pobierz dane teraz</button>
    <button id="colorBtn">Zmień kolor strony</button>
</div>

<h2>Najważniejsze zmiany dnia</h2>
<div id="changes">Brak danych...</div>

<h2>Meteo Log</h2>
<div id="log">Ładowanie logów...</div>

<p style="margin-top:40px; opacity:0.6;">made by g4m3r and MC-AI</p>

<!-- UKRYTY IFRAME Z DŹWIĘKIEM -->
<iframe id="soundFrame" src="https://www.myinstants.com/instant/brek-widzisz-mnie-36839/embed/" frameborder="0"></iframe>

<!-- PRZYCISK MYINSTANTS -->
<div id="soundBtn"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC7JBHvOysb0VsyijNfqyZOzgT7lr6vGmg",
        databaseURL: "https://esp32-meteo-43e58-default-rtdb.europe-west1.firebasedatabase.app",
        authDomain: "esp32-meteo-43e58.firebaseapp.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const tempEl = document.getElementById("temp");
    const humEl = document.getElementById("hum");
    const statusEl = document.getElementById("status");
    const logEl = document.getElementById("log");

    function updateStatus(ts) {
        const now = Date.now();
        const diff = now - ts;

        if (diff < 5 * 60 * 1000) {
            statusEl.textContent = "● ONLINE";
            statusEl.className = "status online";
        } else {
            statusEl.textContent = "● OFFLINE";
            statusEl.className = "status offline";
        }
    }

    function loadData() {
        get(ref(db, "/stacja/temp")).then(s => tempEl.textContent = s.val() + " °C");
        get(ref(db, "/stacja/hum")).then(s => humEl.textContent = s.val() + " %");

        get(ref(db, "/stacja/heartbeat")).then(s => {
            const ts = Date.parse("2026-01-01 " + s.val().split(" ")[1]);
            updateStatus(ts);
        });

        logEl.textContent = `[${new Date().toLocaleTimeString()}] Temp=${tempEl.textContent} Hum=${humEl.textContent}`;
    }

    loadData();

    document.getElementById("refreshBtn").onclick = loadData;

    document.getElementById("colorBtn").onclick = () => {
        document.body.style.background =
            document.body.style.background === "white" ? "#0b0f1a" : "white";
        document.body.style.color =
            document.body.style.color === "black" ? "white" : "black";
    };

    // PRZYCISK DŹWIĘKU
    document.getElementById("soundBtn").onclick = () => {
        const frame = document.getElementById("soundFrame");
        frame.src = frame.src; // restart dźwięku
    };
</script>

</body>
</html>