<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Meteo Mission Control</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #0a0f1f;
        color: #e0eaff;
        margin: 0;
        padding: 0;
        text-align: center;
    }

    h1 {
        margin-top: 25px;
        font-size: 42px;
        letter-spacing: 3px;
        text-shadow: 0 0 10px #00eaff, 0 0 20px #00eaff;
        animation: pulse 2s infinite alternate;
    }

    @keyframes pulse {
        from { text-shadow: 0 0 10px #00eaff; }
        to   { text-shadow: 0 0 25px #00eaff; }
    }

    .card {
        background: rgba(20, 30, 50, 0.85);
        padding: 25px;
        margin: 25px auto;
        width: 450px;
        border-radius: 15px;
        box-shadow: 0 0 25px rgba(0, 200, 255, 0.25);
        backdrop-filter: blur(4px);
    }

    .value {
        font-size: 45px;
        margin: 10px 0;
        text-shadow: 0 0 10px #00eaff;
    }

    .status {
        font-size: 22px;
        margin-top: 10px;
    }

    .online { color: #00ff88; text-shadow: 0 0 10px #00ff88; }
    .offline { color: #ff4444; text-shadow: 0 0 10px #ff4444; }

    button {
        padding: 12px 22px;
        margin: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 17px;
        color: white;
    }

    #refreshBtn { background: #2563eb; }
    #colorBtn { background: #9333ea; }

    #logBox {
        width: 450px;
        height: 200px;
        margin: 20px auto;
        background: rgba(10, 15, 30, 0.8);
        border-radius: 10px;
        padding: 10px;
        overflow-y: scroll;
        font-family: monospace;
        font-size: 15px;
        text-align: left;
        box-shadow: 0 0 20px rgba(0, 200, 255, 0.2);
        white-space: pre-line;
    }
</style>
</head>
<body>

<h1>METEO MISSION CONTROL</h1>

<div class="card">
    <h2>Temperatura</h2>
    <div id="temp" class="value">-- °C</div>

    <h2>Wilgotność</h2>
    <div id="hum" class="value">-- %</div>

    <div id="status" class="status offline">● OFFLINE</div>

    <button id="refreshBtn">Pobierz dane teraz</button>
    <button id="colorBtn">Zmień kolor strony</button>
</div>

<h2>Najważniejsze zmiany dnia</h2>
<div id="changes">Brak danych...</div>

<h2>Meteo Log</h2>
<div id="logBox">Ładowanie logów...</div>

<p style="margin-top:40px; opacity:0.6;">made by g4m3r and MC-AI</p>

<!-- Firebase SDK (compat mode) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC7JBHvOysb0VsyijNfqyZOzgT7lr6vGmg",
        databaseURL: "https://esp32-meteo-43e58-default-rtdb.europe-west1.firebasedatabase.app",
        authDomain: "esp32-meteo-43e58.firebaseapp.com"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const tempEl = document.getElementById("temp");
    const humEl = document.getElementById("hum");
    const statusEl = document.getElementById("status");
    const logBox = document.getElementById("logBox");

    function updateStatus(ts) {
        const now = Date.now();
        const diff = now - ts;

        if (diff < 5 * 60 * 1000) {
            statusEl.textContent = "● ONLINE";
            statusEl.className = "status online";
        } else {
            statusEl.textContent = "● OFFLINE";
            statusEl.className = "status offline";
        }
    }

    function addLog(text) {
        logBox.textContent += text + "\n";
        logBox.scrollTop = logBox.scrollHeight;
    }

    function loadData() {
        db.ref("/stacja/temp").once("value").then(s => {
            tempEl.textContent = s.val() + " °C";
            addLog(`[${new Date().toLocaleTimeString()}] Temp=${s.val()}°C`);
        });

        db.ref("/stacja/hum").once("value").then(s => {
            humEl.textContent = s.val() + " %";
            addLog(`[${new Date().toLocaleTimeString()}] Hum=${s.val()}%`);
        });

        db.ref("/stacja/heartbeat").once("value").then(s => {
            const ts = Date.parse(s.val());
            updateStatus(ts);
        });
    }

    loadData();
    setInterval(loadData, 30000);

    document.getElementById("refreshBtn").onclick = loadData;

    document.getElementById("colorBtn").onclick = () => {
        document.body.style.background =
            document.body.style.background === "white" ? "#0a0f1f" : "white";
        document.body.style.color =
            document.body.style.color === "black" ? "#e0eaff" : "black";
    };
</script>

</body>
</html>
